import svgToTinyDataUri from "mini-svg-data-uri";
import flattenColorPalette from "tailwindcss/lib/util/flattenColorPalette";
import plugin from "tailwindcss/plugin";

export default plugin(function ({ matchUtilities, theme }) {
  matchUtilities(
    {
      "bg-grid": (value) => ({
        backgroundImage: `url("${svgToTinyDataUri(
          `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32" fill="none" stroke="${value}"><path d="M0 .5H31.5V32"/></svg>`
        )}")`,
      }),
      "bg-grid-small": (value) => ({
        backgroundImage: `url("${svgToTinyDataUri(
          `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="8" height="8" fill="none" stroke="${value}"><path d="M0 .5H31.5V32"/></svg>`
        )}")`,
      }),
      "bg-dot": (value) => ({
        backgroundImage: `url("${svgToTinyDataUri(
          `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="16" height="16" fill="none"><circle fill="${value}" id="pattern-circle" cx="10" cy="10" r="1.6257413380501518"></circle></svg>`
        )}")`,
      }),
      "bg-quaric-pattern": (value) => ({
        backgroundImage: `url("${svgToTinyDataUri(
          `
          <svg width="256" height="128" viewBox="0 0 256 128" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0 5.65293V6.89594L3.02983 0H2.4837L0 5.65293Z" fill="${value}"/>
            <path d="M27.4866 0H26.9866C26.9867 1.40326 26.1846 2.80652 24.5805 3.33894L4 10.6688V16L26.1566 8.10876C30.0522 6.81578 32 3.40788 32 0H31.5C31.5 3.2085 29.6664 6.41702 25.9991 7.63422L25.994 7.63593L4.5 15.2912V11.0215L24.7433 3.81173C26.5722 3.20222 27.4867 1.6011 27.4866 0Z" fill="${value}"/>
            <path d="M96 0C96 3.40788 97.9478 6.81578 101.843 8.10876L124 16L131.03 0H130.484L123.729 15.3729L102.006 7.63593L102.001 7.63422C98.3336 6.41702 96.5 3.2085 96.5 0H96Z" fill="${value}"/>
            <path d="M100.513 0C100.513 1.60068 101.427 3.20138 103.255 3.81125L121.011 10.2551L125.516 0H124.97L120.741 9.62539L103.419 3.33894C101.815 2.80652 101.013 1.40326 101.013 0H100.513Z" fill="${value}"/>
            <path d="M160 0H159.5C159.5 3.2085 157.666 6.41702 153.999 7.63422L153.994 7.63593L132.5 15.2912V11.0215L152.743 3.81173C154.572 3.20222 155.487 1.6011 155.487 0H154.987C154.987 1.40326 154.185 2.80652 152.581 3.33894L132 10.6688V16L154.157 8.10876C158.052 6.81578 160 3.40788 160 0Z" fill="${value}"/>
            <path d="M26.9866 128C26.9866 126.597 26.1846 125.194 24.5805 124.661L7.25888 118.375L3.02983 128H2.4837L6.98942 117.745L24.7448 124.189C26.5727 124.799 27.4866 126.399 27.4866 128H26.9866Z" fill="${value}"/>
            <path d="M32 128C32 124.592 30.0522 121.184 26.1566 119.891L4 112L0 121.104V122.347L4.27059 112.627L25.994 120.364L25.9991 120.366C29.6664 121.583 31.5 124.792 31.5 128H32Z" fill="${value}"/>
            <path d="M154.987 128C154.987 126.597 154.185 125.194 152.581 124.661L135.259 118.375L131.03 128H130.484L134.989 117.745L152.745 124.189C154.573 124.799 155.487 126.399 155.487 128H154.987Z" fill="${value}"/>
            <path d="M229.013 0C229.013 1.40326 229.815 2.80652 231.419 3.33894L248.741 9.62539L252.97 0H253.516L249.011 10.2551L231.255 3.81125C229.427 3.20138 228.513 1.60068 228.513 0H229.013Z" fill="${value}"/>
            <path d="M224 0C224 3.40788 225.948 6.81578 229.843 8.10876L252 16L256 6.89594V5.65291L251.729 15.3729L230.006 7.63593L230.001 7.63422C226.334 6.41702 224.5 3.2085 224.5 0H224Z" fill="${value}"/>
            <path d="M256 121.104V122.347L253.516 128H252.97L256 121.104Z" fill="${value}"/>
            <path d="M229.013 128C229.013 126.597 229.815 125.194 231.419 124.661L252 117.331V112L229.843 119.891C225.948 121.184 224 124.592 224 128H224.5C224.5 124.792 226.334 121.583 230.001 120.366L230.006 120.364L251.5 112.709V116.978L231.257 124.188C229.428 124.798 228.513 126.399 228.513 128H229.013Z" fill="${value}"/>
            <path d="M160 128H159.5C159.5 124.792 157.666 121.583 153.999 120.366L153.994 120.364L132.271 112.627L125.516 128H124.97L132 112L154.157 119.891C158.052 121.184 160 124.592 160 128Z" fill="${value}"/>
            <path d="M101.013 128C101.013 126.597 101.815 125.194 103.419 124.661L124 117.331V112L101.843 119.891C97.9478 121.184 96 124.592 96 128H96.5C96.5 124.792 98.3336 121.583 102.001 120.366L102.006 120.364L123.5 112.709V116.978L103.257 124.188C101.428 124.798 100.513 126.399 100.513 128H101.013Z" fill="${value}"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M50.5 52.75C46.2198 52.75 42.75 56.2198 42.75 60.5V67.5C42.75 71.7802 46.2198 75.25 50.5 75.25L73.5097 75.25C77.7854 75.2448 81.25 71.777 81.25 67.5V60.5C81.25 56.2198 77.7802 52.75 73.5 52.75H50.5ZM43.25 60.5C43.25 56.4959 46.4959 53.25 50.5 53.25H73.5C77.5041 53.25 80.75 56.4959 80.75 60.5V67.5C80.75 71.5011 77.509 74.7451 73.5091 74.75L50.5 74.75C46.4959 74.75 43.25 71.5041 43.25 67.5V60.5Z" fill="${value}"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M50.5 47.75C43.4584 47.75 37.75 53.4584 37.75 60.5V67.5C37.75 74.5416 43.4584 80.25 50.5 80.25L90.25 80.25V74.75H83.9895C85.4148 72.6916 86.25 70.193 86.25 67.5V60.5C86.25 53.4584 80.5416 47.75 73.5 47.75H50.5ZM38.25 60.5C38.25 53.7345 43.7345 48.25 50.5 48.25H73.5C80.2655 48.25 85.75 53.7345 85.75 60.5V67.5C85.75 70.258 84.8389 72.8025 83.301 74.8499L83.0005 75.25H89.75V79.75L50.5 79.75C43.7345 79.75 38.25 74.2655 38.25 67.5V60.5Z" fill="${value}"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M187 48C180.096 48 174.5 53.5964 174.5 60.5V80H179.5V60.5C179.5 56.3579 182.858 53 187 53H209.5V48H187ZM187 48.5C180.373 48.5 175 53.8726 175 60.5V79.5H179V60.5C179 56.0817 182.582 52.5 187 52.5H209V48.5H187Z" fill="${value}"/>
          </svg>
          `
        )}")`,
      }),
    },
    { values: flattenColorPalette(theme("backgroundColor")), type: "color" }
  );
});
